​	

To decode more accurate part-aware locations, we consider the inherent relation constraint among joints via GCN to encode the relational guidance into the pose prototypes.

​	经过自顶向下的pipeline，将检测到的单人图像输入到基于cnn的网络中，得到特征图X∈R^(H×W ×D)，其中H、W、D为高、宽、通道。我们用1 × 1卷积将X变成X '∈R^H×W ×C, C为关键点类的个数。然后，再加上GAP、FC和一个用于分类的softmax层，如图2所示，我们得到了类别特定的激活映射M = [m1, m2，…， mc]∈R^H×W ×C，将FC的权值与特征映射X '卷积如下:

![image-20221106220822222](E:\MarkDown\picture\image-20221106220822222.png)

其中w^c和x'k分别表示第c个类别和第k个特征图的权重.

为了获取RGP-De中图的初始节点嵌入(见第3.4节)，我们计算特定于类别的关键点向量Fc = [f1, f2，…, fc]∈R^C×D '作为:

![image-20221106220945333](E:\MarkDown\picture\image-20221106220945333.png)

其中x' i,j，x^c i,j是特征映射的(i, j)-th个特征，Xc∈R^H×W ×D '是用1 × 1卷积得到的

![image-20221106221150967](E:\MarkDown\picture\image-20221106221150967.png)

关系编码的姿态原型生成

​	值得注意的是，人体姿态具有符合运动学约束的固有结构。例如，相邻或对称的关节更有可能拥有高度一致的语义信息。因此，我们设计了RePPG，将关节的关系集成到更新的姿势原型中，以解析更精确的部位感知位置。

​	我们首先引入一组位姿原型![image-20221106225306588](E:\MarkDown\picture\image-20221106225306588.png) ，它**决定了特征Fm的像素是否属于第i部分(因为是heatmap展开来的)**。我们初始化公式2中类别特定的关键点特征Fc作为PC的节点特征。基于Fc，我们构建了一个直观的图形G = (V, E)。V = {vi, i = 1,2，…， C}是描述关键点的节点集。E = {vivj | if i and j are connected in human body}表示肢体。根据预定义运动学连接，当vi和vj在G中相邻或i = j时，对相邻矩阵A = {aij}进行初始化aij = 1，否则aij = 0。

​	考虑到人体结构是一个关节间具有空间约束的自然图，因此我们通过最近的SemGCN[49]对关键点关系进行建模，以探索它们之间的结构关系。对于图卷积，通过邻域传播特征有助于学习鲁棒结构并捕获联合相关性。这使姿态原型具有结构关系先验，对于在解码时激活不确定部分的响应至关重要。

​	具体来说，首先从节点的邻居j中收集更新的节点特征到节点i，如式2所示，将初始节点特征收集到![image-20221106230726354](E:\MarkDown\picture\image-20221106230726354.png)。

![image-20221106230734460](E:\MarkDown\picture\image-20221106230734460.png)



​	其中Fc(l)和Fc(l+1)为l-th卷积前后的节点特征，φi为归一化，W (l+1)为权重矩阵。Mr∈R^C×C表示关节和具有节点特征的更新之间的局部语义关系。由此得到编码局部语义关系和空间关系的更新姿态原型![image-20221106231131877](E:\MarkDown\picture\image-20221106231131877.png)

![image-20221106231247597](E:\MarkDown\picture\image-20221106231247597.png)

​	交叉注意层旨在通过Fm与原型P’c之间的交互来学习更具体的局部感知特征，如图3 (b)所示，给定Fm，Q来自原型![image-20221106231338878](E:\MarkDown\picture\image-20221106231338878.png)，键和值来自特征Fm。实现方法与上述SA学习相同，所有h×w位置的注意权重组成一个部分感知响应映射Ri = [Ri,1, Ri,2, Ri,3，…， ri,hw]，有高响应值的上下文特征属于第i部分。然后通过池化运算得到第i部分特征。通过对所有原型的计算，我们得到C部分响应映射(每个映射是一个注意映射)和相应的部分特征![image-20221106231641000](E:\MarkDown\picture\image-20221106231641000.png)。最后，通过求其响应图的最大值得到关键点位置图。

RePPG有效性

![image-20221106232510274](E:\MarkDown\picture\image-20221106232510274.png)

这有力地说明了挖掘潜在的结构关键点关系进行指导的必要性。

在我们的设置中，姿势原型从数据集中学习关键点之间的统计相关性，作为先验知识。为了表示这些原型中编码的信息，我们计算它们的内积矩阵，并将其在图6中不同情况下可视化。图6 (d)表明，一个趋向于与它的对称关键点或相邻关键点高度相关。如左髋多与右髋、左肩相关，相关度高。这一发现符合我们的常识，揭示了模型学习的内容。但图6 (b)主要是自相关学习，说明RePPG可以编码更显式的局部关键点关系。



![image-20221106232747791](E:\MarkDown\picture\image-20221106232747791.png)

学习过的姿态原型的内积矩阵。矩阵的每一行表示学习到的给定类型的关键点与其他关键点的先验关系。(a)描述了随机初始化;(b)描述SA处理过的图像;(c)初始联合相关性;(d) RePPG学到的描述。







