3D HPE

## ç›¸å…³ç«èµ›

### 1.LIP

ä½†æ˜¯æ²¡æ‰¾åˆ°æ¯”èµ›ç½‘å€

![image-20220331193047635](E:\MarkDown\picture\image-20220331193047635.png)

### 2.COCO Keypoints Challenge

[1](https://competitions.codalab.org/competitions/12061#:~:text=The%20COCO%20Keypoint%20Challenge%20requires%20localization%20of%20person,this%20task%20please%20read%20the%20keypoint%20evaluation%20page.)

ä½†å¥½åƒåˆ°2020ä¹‹åå°±æ²¡å†æ›´æ–°

### 3.kaggle























### å›å½’

æ•°å€¼åæ ‡å›å½’ï¼Œé‡‡ç”¨å…¨è¿æ¥å±‚ç›´æ¥å›å½’åæ ‡ç‚¹ã€‚

ç–‘é—®ï¼šä¸ºä»€ä¹ˆæ˜¯ç”¨å…¨è¿æ¥å±‚å›å½’ï¼Ÿ
æŠŠåˆ†å¸ƒå¼ç‰¹å¾ representation æ˜ å°„åˆ°æ ·æœ¬æ ‡è®°ç©ºé—´ï¼Œå³**æŠŠç‰¹å¾representationæ•´åˆåˆ°ä¸€èµ·ï¼Œè¾“å‡ºä¸ºä¸€ä¸ªå€¼ã€‚**
<img src="E:\MarkDown\picture\image-20220324144050636.png" alt="image-20220324144050636" style="zoom:50%;" />
å…¨è¿æ¥å±‚çš„ä½œç”¨å°±æ˜¯ä½¿å¾—å³ä½¿åœ¨è¾“å‡ºçš„ç‰¹å¾å›¾ä¸­çŒ«çš„ä½ç½®ä¸åŒï¼Œåˆ†ç±»ç»“æœä¹Ÿä¸€æ ·ã€‚å› ä¸ºç©ºé—´ç»“æ„ç‰¹æ€§è¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥å…¨è¿æ¥å±‚ä¸é€‚åˆç”¨äºåœ¨æ–¹ä½ä¸Šæ‰¾ Pattern çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ segmentationã€‚è€Œä¸”FCä¸€èˆ¬æœ‰ä¸¤å±‚ï¼Œå¯ä»¥æ›´å¥½çš„æ‹Ÿåˆéçº¿æ€§ä¿¡æ¯



ä¼˜ç‚¹æ˜¯è¾“å‡ºå³ä¸ºåæ ‡ç‚¹ï¼Œè®­ç»ƒå’Œå‰å‘é€Ÿåº¦å¯ä»¥å¾ˆå¿«ï¼Œä¸”æ˜¯ç«¯åˆ°ç«¯çš„å…¨å¾®åˆ†è®­ç»ƒï¼›ç¼ºç‚¹æ˜¯ç¼ºä¹ç©ºé—´æ³›åŒ–èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¢å¤±äº†ç‰¹å¾å›¾ä¸Šé¢çš„ç©ºé—´ä¿¡æ¯ã€‚



### PCK

PCKæ˜¯mpiiä½¿ç”¨çš„äººä½“å…³é”®ç‚¹ä¼°è®¡è¯„ä»·æ ‡å‡†ï¼Œåœ¨cocoä¹‹å‰ï¼ŒPCKä¸€ç›´æ˜¯æ¯”è¾ƒä¸»æµçš„metricï¼ŒåŒ…æ‹¬deepfashionï¼ŒfashionAIç­‰ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„æ­¤æ ‡å‡†ã€‚

```
è¯„ä»·æŒ‡æ ‡ä¸€èˆ¬æ˜¯ç”¨PCKï¼ˆPCKhï¼‰å’ŒOKS+mAPï¼Œç®€å•æ¥è¯´ï¼Œå‰è€…å°±æ˜¯è®¡ç®—predictå’Œlabelç‚¹çš„è·ç¦»å†ç»è¿‡head size normalizeï¼Œåè€…å°±æ˜¯ç”¨ç±»ä¼¼äºç›®æ ‡æ£€æµ‹ä¸­IOUçš„OKSè®¡ç®—ç›¸ä¼¼åº¦ï¼Œç„¶åå†ç®—APã€‚è™½ç„¶å‰è€…åœ¨å­¦æœ¯ç•Œç›®å‰å·²ç»å¾ˆå°‘ä½¿ç”¨ï¼ˆä¸»è¦æ˜¯åˆ·æ¦œåˆ·å¾—å¤ªé«˜äº†ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬åœºæ™¯åªéœ€è¦å•äººï¼ŒåŠ ä¸Šå·¥ç¨‹åŒ–ç®€å•ï¼Œè‚¯å®šæ˜¯é€‰æ‹©PCK
```

è®¾å®šçš„é˜ˆå€¼æ˜¯0.5

![image-20220224173021860](E:\MarkDown\picture\image-20220224173021860.png)

<img src="E:\MarkDown\picture\image-20220224173036643.png" alt="image-20220224173036643" style="zoom:50%;" />

```python
# from mmpose
def keypoint_pck_accuracy(pred, gt, mask, thr, normalize):
    """Calculate the pose accuracy of PCK for each individual keypoint and the
    averaged accuracy across all keypoints for coordinates.

    Note:
        PCK metric measures accuracy of the localization of the body joints.
        The distances between predicted positions and the ground-truth ones
        are typically normalized by the bounding box size.
        The threshold (thr) of the normalized distance is commonly set
        as 0.05, 0.1 or 0.2 etc.

        batch_size: N
        num_keypoints: K

    Args:
        pred (np.ndarray[N, K, 2]): Predicted keypoint location.
        gt (np.ndarray[N, K, 2]): Groundtruth keypoint location.
        mask (np.ndarray[N, K]): Visibility of the target. False for invisible
            joints, and True for visible. Invisible joints will be ignored for
            accuracy calculation.
        thr (float): Threshold of PCK calculation.
        normalize (np.ndarray[N, 2]): Normalization factor for H&W.

    Returns:
        tuple: A tuple containing keypoint accuracy.

        - acc (np.ndarray[K]): Accuracy of each keypoint.
        - avg_acc (float): Averaged accuracy across all keypoints.
        - cnt (int): Number of valid keypoints.
    """
    distances = _calc_distances(pred, gt, mask, normalize)

    acc = np.array([_distance_acc(d, thr) for d in distances])
    valid_acc = acc[acc >= 0]
    cnt = len(valid_acc)
    avg_acc = valid_acc.mean() if cnt > 0 else 0
    return acc, avg_acc, cnt

def _calc_distances(preds, targets, mask, normalize):
    """Calculate the normalized distances between preds and target.

    Note:
        batch_size: N
        num_keypoints: K
        dimension of keypoints: D (normally, D=2 or D=3)

    Args:
        preds (np.ndarray[N, K, D]): Predicted keypoint location.
        targets (np.ndarray[N, K, D]): Groundtruth keypoint location.
        mask (np.ndarray[N, K]): Visibility of the target. False for invisible
            joints, and True for visible. Invisible joints will be ignored for
            accuracy calculation.
        normalize (np.ndarray[N, D]): Typical value is heatmap_size

    Returns:
        np.ndarray[K, N]: The normalized distances.
          If target keypoints are missing, the distance is -1.
    """
    N, K, _ = preds.shape
    distances = np.full((N, K), -1, dtype=np.float32)
    # handle invalid values
    normalize[np.where(normalize <= 0)] = 1e6
    distances[mask] = np.linalg.norm(
        ((preds - targets) / normalize[:, None, :])[mask], axis=-1)
    return distances.T

def _distance_acc(distances, thr=0.5):
    """Return the percentage below the distance threshold, while ignoring
    distances values with -1.

    Note:
        batch_size: N
    Args:
        distances (np.ndarray[N, ]): The normalized distances.
        thr (float): Threshold of the distances.

    Returns:
        float: Percentage of distances below the threshold.
          If all target keypoints are missing, return -1.
    """
    distance_valid = distances != -1
    num_distance_valid = distance_valid.sum()
    if num_distance_valid > 0:
        return (distances[distance_valid] < thr).sum() / num_distance_valid
    return -1
```



### OKS

	Object Keypoint Similarityï¼Œç›¸ä¼¼æ€§åº¦é‡æŒ‡æ ‡ï¼Œç”¨äºåº¦é‡æ£€æµ‹åˆ°çš„å…³èŠ‚ç‚¹å’Œæ ‡ç­¾ä¸­çš„å…³èŠ‚ç‚¹ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚
	è®¾å®šä¸€ä¸ªé˜ˆå€¼ğ‘¡ï¼Œè‹¥å½“å‰å…³èŠ‚ç‚¹çš„OKSå¤§äºğ‘¡ï¼Œåˆ™è¡¨ç¤ºè¯¥å…³èŠ‚ç‚¹è¢«æ­£ç¡®æ£€å‡ºï¼›è‹¥å½“å‰å…³èŠ‚ç‚¹çš„OKSå°äºğ‘¡ï¼Œ åˆ™è¡¨ç¤ºè¯¥å…³èŠ‚ç‚¹æ£€æµ‹ç²¾åº¦ä¸å¤Ÿæˆ–è¢«æ¼æ£€ã€‚
	
	L2èŒƒæ•°ï¼šå‘é‡æ‰€æœ‰å…ƒç´ çš„å¹³æ–¹å’Œçš„å¼€å¹³æ–¹

è¿™é‡Œå›¾ç‰‡é‡Œæœ‰ç‚¹é”™è¯¯ï¼Œki=Î´iï¼Œåªæ˜¯å†™æ³•ä¸åŒã€‚
sçš„è¯ï¼Œå…¶é¢ç§¯æŒ‰groundtruthé‡Œäººçš„boxçš„1.25å€è®¡ç®—

![image-20220224160049805](E:\MarkDown\picture\image-20220224160049805.png)

![image-20220224160736580](E:\MarkDown\picture\image-20220224160736580.png)



![image-20220224160114418](E:\MarkDown\picture\image-20220224160114418.png)

#### APã€AR

 Average Precision å¹³å‡å‡†ç¡®ç‡/æŸ¥å‡†ç‡ï¼Œç»Ÿè®¡è¢«æ­£ç¡®æ£€å‡ºçš„å…³èŠ‚ç‚¹çš„æ•°é‡åœ¨æ‰€æœ‰æ£€æµ‹å‡ºçš„å…³èŠ‚ç‚¹ä¸­çš„æ¯”ä¾‹
![image-20220224161427509](E:\MarkDown\picture\image-20220224161427509.png)

### 









## å¸ˆå§ç¨‹åº

ç¬¬äºŒç« ï¼š[UDP-Pose](https://github.com/HuangJunJie2017/UDP-Pose)çš„ç¨‹åº

æ–‡ä»¶æœ‰é»„æœ‰ç»¿ï¼šgité¡¹ç›®[gité¡¹ç›®ï¼ŒVSCodeæ˜¾ç¤ºä¸åŒé¢œè‰²å—å«ä¹‰](https://www.cnblogs.com/soyxiaobi/p/9708518.html)

test.pyä¸­éœ€è¦çš„æ¨¡å‹æ–‡ä»¶åœ¨yamlæ–‡ä»¶é‡Œé…ç½®äº†ï¼Œæœ‰éœ€è¦å°±è‡ªå·±æ”¹
evaluate.pyä¸­æŒ‡æ ‡çš„è®¡ç®—å¥½åƒä¸æ˜¯OKSï¼Ÿçœ‹ç€åƒPCK

cocoæœ‰è‡ªå¸¦çš„oksè®¡ç®—ï¼Œçœ‹çœ‹ç”¨çš„æ˜¯å“ªä¸ª

